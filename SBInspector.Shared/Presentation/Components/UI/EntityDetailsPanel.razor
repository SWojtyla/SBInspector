@using SBInspector.Shared.Core.Domain
@using MudBlazor

<MudPaper Class="pa-2 mud-elevation-2">
    @if (EntityType == "queue" && QueueInfo != null)
    {
        <MudStack Spacing="2">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.Inbox" Size="Size.Large" />
                    <MudText Typo="Typo.h5">@QueueInfo.Name</MudText>
                    <MudChip T="string" Color="@(QueueInfo.Status == "Active" ? Color.Success : Color.Default)" Variant="Variant.Filled" Size="Size.Small">
                        @QueueInfo.Status
                    </MudChip>
                </MudStack>
                <MudButton Variant="Variant.Filled" Color="@(QueueInfo.Status == "Active" ? Color.Secondary : Color.Success)"
                           OnClick="@(() => OnToggleStatus.InvokeAsync())" Size="Size.Small">
                    <MudIcon Icon="@(QueueInfo.Status == "Active" ? Icons.Material.Filled.PauseCircle : Icons.Material.Filled.PlayCircle)" Size="Size.Small" /> @(QueueInfo.Status == "Active" ? "Disable" : "Enable")
                </MudButton>
            </MudStack>

            <MudText Typo="Typo.subtitle1" Class="mt-2">Message Counts</MudText>
            <MudGrid>
                <MudItem xs="12" sm="4">
                    <MudPaper Class="pa-3" Elevation="2" Style="cursor:pointer;" @onclick="@(() => OnViewMessages.InvokeAsync("Active"))">
                        <MudStack AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Inbox" Color="Color.Primary" Size="Size.Large" />
                            <MudText Typo="Typo.body2" Align="Align.Center">Active Messages</MudText>
                            <MudText Typo="Typo.h4" Color="Color.Primary">@QueueInfo.ActiveMessageCount</MudText>
                            @if (QueueInfo.ActiveMessageCount > 0)
                            {
                                <MudButton Variant="Variant.Text" Color="Color.Primary" Size="Size.Small" StartIcon="@Icons.Material.Filled.Visibility">View</MudButton>
                            }
                        </MudStack>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="4">
                    <MudPaper Class="pa-3" Elevation="2" Style="cursor:pointer;" @onclick="@(() => OnViewMessages.InvokeAsync("Scheduled"))">
                        <MudStack AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Schedule" Color="Color.Warning" Size="Size.Large" />
                            <MudText Typo="Typo.body2" Align="Align.Center">Scheduled Messages</MudText>
                            <MudText Typo="Typo.h4" Color="Color.Warning">@QueueInfo.ScheduledMessageCount</MudText>
                            @if (QueueInfo.ScheduledMessageCount > 0)
                            {
                                <MudButton Variant="Variant.Text" Color="Color.Warning" Size="Size.Small" StartIcon="@Icons.Material.Filled.Visibility">View</MudButton>
                            }
                        </MudStack>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="4">
                    <MudPaper Class="pa-3" Elevation="2" Style="cursor:pointer;" @onclick="@(() => OnViewMessages.InvokeAsync("DeadLetter"))">
                        <MudStack AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.ReportProblem" Color="Color.Error" Size="Size.Large" />
                            <MudText Typo="Typo.body2" Align="Align.Center">Dead Letter Messages</MudText>
                            <MudText Typo="Typo.h4" Color="Color.Error">@QueueInfo.DeadLetterMessageCount</MudText>
                            @if (QueueInfo.DeadLetterMessageCount > 0)
                            {
                                <MudButton Variant="Variant.Text" Color="Color.Error" Size="Size.Small" StartIcon="@Icons.Material.Filled.Visibility">View</MudButton>
                            }
                        </MudStack>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudStack>
    }
    else if (EntityType == "topic" && TopicInfo != null)
    {
        <MudStack Spacing="2">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.Campaign" Size="Size.Large" />
                    <MudText Typo="Typo.h5">@TopicInfo.Name</MudText>
                    <MudChip T="string" Color="@(TopicInfo.Status == "Active" ? Color.Success : Color.Default)" Variant="Variant.Filled" Size="Size.Small">
                        @TopicInfo.Status
                    </MudChip>
                </MudStack>
                <MudButton Variant="Variant.Filled" Color="@(TopicInfo.Status == "Active" ? Color.Secondary : Color.Success)"
                           OnClick="@(() => OnToggleStatus.InvokeAsync())" Size="Size.Small">
                    <MudIcon Icon="@(TopicInfo.Status == "Active" ? Icons.Material.Filled.PauseCircle : Icons.Material.Filled.PlayCircle)" Size="Size.Small" /> @(TopicInfo.Status == "Active" ? "Disable" : "Enable")
                </MudButton>
            </MudStack>

            <MudAlert Severity="Severity.Info" Class="mt-3">
                Select a subscription from the tree to view its messages.
            </MudAlert>
        </MudStack>
    }
    else if (EntityType == "subscription" && SubscriptionInfo != null)
    {
        <MudStack Spacing="2">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.Email" Size="Size.Large" />
                    <MudText Typo="Typo.h5">@TopicName / @SubscriptionInfo.Name</MudText>
                    <MudChip T="string" Color="@(SubscriptionInfo.Status == "Active" ? Color.Success : Color.Default)" Variant="Variant.Filled" Size="Size.Small">
                        @SubscriptionInfo.Status
                    </MudChip>
                </MudStack>
                <MudButton Variant="Variant.Filled" Color="@(SubscriptionInfo.Status == "Active" ? Color.Secondary : Color.Success)"
                           OnClick="@(() => OnToggleStatus.InvokeAsync())" Size="Size.Small">
                    <MudIcon Icon="@(SubscriptionInfo.Status == "Active" ? Icons.Material.Filled.PauseCircle : Icons.Material.Filled.PlayCircle)" Size="Size.Small" /> @(SubscriptionInfo.Status == "Active" ? "Disable" : "Enable")
                </MudButton>
            </MudStack>

            <MudText Typo="Typo.subtitle1" Class="mt-2">Message Counts</MudText>
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudPaper Class="pa-3" Elevation="2" Style="cursor:pointer;" @onclick="@(() => OnViewMessages.InvokeAsync("Active"))">
                        <MudStack AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Inbox" Color="Color.Primary" Size="Size.Large" />
                            <MudText Typo="Typo.body2" Align="Align.Center">Active Messages</MudText>
                            <MudText Typo="Typo.h4" Color="Color.Primary">@SubscriptionInfo.ActiveMessageCount</MudText>
                            @if (SubscriptionInfo.ActiveMessageCount > 0)
                            {
                                <MudButton Variant="Variant.Text" Color="Color.Primary" Size="Size.Small" StartIcon="@Icons.Material.Filled.Visibility">View</MudButton>
                            }
                        </MudStack>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudPaper Class="pa-3" Elevation="2" Style="cursor:pointer;" @onclick="@(() => OnViewMessages.InvokeAsync("DeadLetter"))">
                        <MudStack AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.ReportProblem" Color="Color.Error" Size="Size.Large" />
                            <MudText Typo="Typo.body2" Align="Align.Center">Dead Letter Messages</MudText>
                            <MudText Typo="Typo.h4" Color="Color.Error">@SubscriptionInfo.DeadLetterMessageCount</MudText>
                            @if (SubscriptionInfo.DeadLetterMessageCount > 0)
                            {
                                <MudButton Variant="Variant.Text" Color="Color.Error" Size="Size.Small" StartIcon="@Icons.Material.Filled.Visibility">View</MudButton>
                            }
                        </MudStack>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudStack>
    }
    else
    {
        <MudStack AlignItems="AlignItems.Center" Spacing="1" Class="pa-4">
            <MudIcon Icon="@Icons.Material.Filled.ArrowBack" Size="Size.Large" />
            <MudText Typo="Typo.h6">Select an entity from the tree</MudText>
            <MudText Typo="Typo.body2">Choose a queue, topic, or subscription to view its details and messages.</MudText>
        </MudStack>
    }
</MudPaper>

@code {
    [Parameter]
    public string? EntityType { get; set; }

    [Parameter]
    public EntityInfo? QueueInfo { get; set; }

    [Parameter]
    public EntityInfo? TopicInfo { get; set; }

    [Parameter]
    public SubscriptionInfo? SubscriptionInfo { get; set; }

    [Parameter]
    public string? TopicName { get; set; }

    [Parameter]
    public EventCallback<string> OnViewMessages { get; set; }

    [Parameter]
    public EventCallback OnToggleStatus { get; set; }
}
