@using SBInspector.Shared.Core.Domain
@using MudBlazor

<MudPaper Class="pa-2 mud-elevation-2">
    @if (EntityType == "queue" && QueueInfo != null)
    {
        <MudStack Spacing="2">
            <MudStack Direction="Row" AlignItems="AlignItems.Center" JustifyContent="SpaceBetween">
                <MudText Typo="Typo.h5"><MudIcon Icon="@Icons.Material.Filled.Inbox" /> @QueueInfo.Name</MudText>
                <MudChip T=EntityInfo Color="@(QueueInfo.Status == "Active" ? Color.Success : Color.Default)" Variant="Variant.Filled">
                    @QueueInfo.Status
                </MudChip>
                <MudButton Variant="Variant.Filled" Color="@(QueueInfo.Status == "Active" ? Color.Secondary : Color.Success)"
                           OnClick="@(async () => await OnToggleStatus.InvokeAsync())">
                    <MudIcon Icon="@(QueueInfo.Status == "Active" ? Icons.Material.Filled.PauseCircle : Icons.Material.Filled.PlayCircle)" /> @(QueueInfo.Status == "Active" ? "Disable" : "Enable")
                </MudButton>
            </MudStack>

            <MudText Typo="Typo.h6">Message Counts</MudText>
            <MudStack Direction="Row" Spacing="2">
                <MudPaper Class="pa-2" Style="cursor:pointer;" @onclick="@(async () => await OnViewMessages.InvokeAsync("Active"))">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.Inbox" Color="Color.Primary" />
                        <MudText Typo="Typo.subtitle2">Active Messages</MudText>
                        <MudChip T=EntityInfo Color="Color.Primary">@QueueInfo.ActiveMessageCount</MudChip>
                        @if (QueueInfo.ActiveMessageCount >0)
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small">View</MudButton>
                        }
                    </MudStack>
                </MudPaper>
                
                <MudPaper Class="pa-2" Style="cursor:pointer;" @onclick="@(async () => await OnViewMessages.InvokeAsync("Scheduled"))">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.Schedule" Color="Color.Warning" />
                        <MudText Typo="Typo.subtitle2">Scheduled Messages</MudText>
                        <MudChip T=EntityInfo Color ="Color.Warning">@QueueInfo.ScheduledMessageCount</MudChip>
                        @if (QueueInfo.ScheduledMessageCount >0)
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Warning" Size="Size.Small">View</MudButton>
                        }
                    </MudStack>
                </MudPaper>
                
                <MudPaper Class="pa-2" Style="cursor:pointer;" @onclick="@(async () => await OnViewMessages.InvokeAsync("DeadLetter"))">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.ReportProblem" Color="Color.Error" />
                        <MudText Typo="Typo.subtitle2">Dead Letter Messages</MudText>
                        <MudChip T=EntityInfo Color="Color.Error">@QueueInfo.DeadLetterMessageCount</MudChip>
                        @if (QueueInfo.DeadLetterMessageCount >0)
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Error" Size="Size.Small">View</MudButton>
                        }
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudStack>
    }
    else if (EntityType == "topic" && TopicInfo != null)
    {
        <MudStack Spacing="2">
            <MudStack Direction="Row" AlignItems="AlignItems.Center" JustifyContent="SpaceBetween">
                <MudText Typo="Typo.h5"><MudIcon Icon="@Icons.Material.Filled.Campaign" /> @TopicInfo.Name</MudText>
                <MudChip T=EntityInfo Color ="@(TopicInfo.Status == "Active" ? Color.Success : Color.Default)" Variant="Variant.Filled">
                    @TopicInfo.Status
                </MudChip>
                <MudButton Variant="Variant.Filled" Color="@(TopicInfo.Status == "Active" ? Color.Secondary : Color.Success)"
                           OnClick="@(async () => await OnToggleStatus.InvokeAsync())">
                    <MudIcon Icon="@(TopicInfo.Status == "Active" ? Icons.Material.Filled.PauseCircle : Icons.Material.Filled.PlayCircle)" /> @(TopicInfo.Status == "Active" ? "Disable" : "Enable")
                </MudButton>
            </MudStack>

            <MudAlert Severity="Severity.Info" Variant="Variant.Filled">
                <MudIcon Icon="@Icons.Material.Filled.Info" /> Select a subscription from the tree to view its messages.
            </MudAlert>
        </MudStack>
    }
    else if (EntityType == "subscription" && SubscriptionInfo != null)
    {
        <MudStack Spacing="2">
            <MudStack Direction="Row" AlignItems="AlignItems.Center" JustifyContent="SpaceBetween">
                <MudText Typo="Typo.h5"><MudIcon Icon="@Icons.Material.Filled.Email" /> @TopicName / @SubscriptionInfo.Name</MudText>
                <MudChip T=SubscriptionInfo Color="@(SubscriptionInfo.Status == "Active" ? Color.Success : Color.Default)" Variant="Variant.Filled">
                    @SubscriptionInfo.Status
                </MudChip>
                <MudButton Variant="Variant.Filled" Color="@(SubscriptionInfo.Status == "Active" ? Color.Secondary : Color.Success)"
                           OnClick="@(async () => await OnToggleStatus.InvokeAsync())">
                    <MudIcon Icon="@(SubscriptionInfo.Status == "Active" ? Icons.Material.Filled.PauseCircle : Icons.Material.Filled.PlayCircle)" /> @(SubscriptionInfo.Status == "Active" ? "Disable" : "Enable")
                </MudButton>
            </MudStack>

            <MudText Typo="Typo.h6">Message Counts</MudText>
            <MudStack Direction="Row" Spacing="2">
                <MudPaper Class="pa-2" Style="cursor:pointer;" @onclick="@(async () => await OnViewMessages.InvokeAsync("Active"))">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.Inbox" Color="Color.Primary" />
                        <MudText Typo="Typo.subtitle2">Active Messages</MudText>
                        <MudChip T=SubscriptionInfo Color="Color.Primary">@SubscriptionInfo.ActiveMessageCount</MudChip>
                        @if (SubscriptionInfo.ActiveMessageCount >0)
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small">View</MudButton>
                        }
                    </MudStack>
                </MudPaper>
                
                <MudPaper Class="pa-2" Style="cursor:pointer;" @onclick="@(async () => await OnViewMessages.InvokeAsync("DeadLetter"))">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.ReportProblem" Color="Color.Error" />
                        <MudText Typo="Typo.subtitle2">Dead Letter Messages</MudText>
                        <MudChip T=SubscriptionInfo Color="Color.Error">@SubscriptionInfo.DeadLetterMessageCount</MudChip>
                        @if (SubscriptionInfo.DeadLetterMessageCount >0)
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Error" Size="Size.Small">View</MudButton>
                        }
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudStack>
    }
    else
    {
        <MudStack AlignItems="AlignItems.Center" Spacing="1" Class="pa-4">
            <MudIcon Icon="@Icons.Material.Filled.ArrowBack" Size="Size.Large" />
            <MudText Typo="Typo.h6">Select an entity from the tree</MudText>
            <MudText Typo="Typo.body2">Choose a queue, topic, or subscription to view its details and messages.</MudText>
        </MudStack>
    }
</MudPaper>

@code {
    [Parameter]
    public string? EntityType { get; set; }

    [Parameter]
    public EntityInfo? QueueInfo { get; set; }

    [Parameter]
    public EntityInfo? TopicInfo { get; set; }

    [Parameter]
    public SubscriptionInfo? SubscriptionInfo { get; set; }

    [Parameter]
    public string? TopicName { get; set; }

    [Parameter]
    public EventCallback<string> OnViewMessages { get; set; }

    [Parameter]
    public EventCallback OnToggleStatus { get; set; }
}
