@if (IsVisible)
{
    <MudOverlay Visible="true" ZIndex="9999" DarkBackground="true" AutoClose="false">
        <MudPaper Elevation="8" Class="pa-6" Style="max-width: 500px; width: 100%;">
            <MudStack Spacing="4">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudText Typo="Typo.h6">
                        <MudIcon Icon="@GetMudIcon(IconClass)" Class="mr-2" />
                        @Title
                    </MudText>
                    <MudIconButton Icon="@Icons.Material.Filled.Close" OnClick="HandleCancel" Size="Size.Small" />
                </MudStack>
                
                <MudDivider />
                
                <MudText>@Message</MudText>
                
                <MudStack Row="true" Justify="Justify.FlexEnd" Spacing="2" Class="mt-2">
                    <MudButton OnClick="HandleCancel" Variant="Variant.Text">
                        <MudIcon Icon="@Icons.Material.Filled.Close" Class="mr-1" Size="Size.Small" />
                        Cancel
                    </MudButton>
                    <MudButton OnClick="HandleConfirm" Color="@GetButtonColor()" Variant="Variant.Filled">
                        <MudIcon Icon="@GetConfirmIcon()" Class="mr-1" Size="Size.Small" />
                        @ConfirmText
                    </MudButton>
                </MudStack>
            </MudStack>
        </MudPaper>
    </MudOverlay>
}

@code {
    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public string Title { get; set; } = "Confirm Action";

    [Parameter]
    public string Message { get; set; } = "Are you sure?";

    [Parameter]
    public string ConfirmText { get; set; } = "Confirm";

    [Parameter]
    public string IconClass { get; set; } = "bi-question-circle";

    [Parameter]
    public string ConfirmIconClass { get; set; } = "bi-check-lg";

    [Parameter]
    public string ConfirmButtonClass { get; set; } = "btn-primary";

    [Parameter]
    public EventCallback OnConfirm { get; set; }

    [Parameter]
    public EventCallback OnCancel { get; set; }

    private async Task HandleConfirm()
    {
        await OnConfirm.InvokeAsync();
    }

    private async Task HandleCancel()
    {
        await OnCancel.InvokeAsync();
    }

    private string GetMudIcon(string bootstrapIcon)
    {
        return bootstrapIcon switch
        {
            "bi-question-circle" => Icons.Material.Filled.Help,
            "bi-exclamation-triangle" => Icons.Material.Filled.Warning,
            "bi-info-circle" => Icons.Material.Filled.Info,
            "bi-check-circle" => Icons.Material.Filled.CheckCircle,
            "bi-x-circle" => Icons.Material.Filled.Cancel,
            "bi-trash" => Icons.Material.Filled.Delete,
            _ => Icons.Material.Filled.Help
        };
    }

    private string GetConfirmIcon()
    {
        return ConfirmIconClass switch
        {
            "bi-check-lg" => Icons.Material.Filled.Check,
            "bi-trash" => Icons.Material.Filled.Delete,
            "bi-x-lg" => Icons.Material.Filled.Close,
            _ => Icons.Material.Filled.Check
        };
    }

    private Color GetButtonColor()
    {
        return ConfirmButtonClass switch
        {
            "btn-danger" => Color.Error,
            "btn-warning" => Color.Warning,
            "btn-success" => Color.Success,
            "btn-info" => Color.Info,
            "btn-primary" => Color.Primary,
            _ => Color.Primary
        };
    }
}
