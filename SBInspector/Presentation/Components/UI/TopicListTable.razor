@using SBInspector.Core.Domain

<div class="mb-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Topics (@FilteredTopics.Count())</h3>
        @if (Topics.Any())
        {
            <div class="search-box">
                <input type="text" class="form-control" placeholder="Search topics..." 
                       @bind="searchTerm" @bind:event="oninput" />
            </div>
        }
    </div>
    
    @if (Topics.Any())
    {
        <div class="table-responsive scrollable-content">
            <table class="table table-striped table-hover table-enhanced">
                <thead>
                    <tr>
                        <th @onclick="() => HandleSortColumn(nameof(EntityInfo.Name))" class="sortable-header">
                            Name @GetSortIcon()
                        </th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var topic in FilteredTopics)
                    {
                        <tr>
                            <td><strong>@topic.Name</strong></td>
                            <td>
                                <div class="action-buttons justify-content-center">
                                    <button class="btn btn-sm btn-info" @onclick="() => OnViewSubscriptions.InvokeAsync(topic.Name)" title="View Subscriptions">
                                        <i class="bi bi-list"></i> View Subscriptions
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        
        @if (!FilteredTopics.Any())
        {
            <div class="alert alert-info mt-3">
                No topics match your search criteria.
            </div>
        }
    }
    else
    {
        <div class="alert alert-warning">
            <i class="bi bi-info-circle"></i> No topics found in this namespace.
        </div>
    }
</div>

@code {
    [Parameter]
    public List<EntityInfo> Topics { get; set; } = new();

    [Parameter]
    public EventCallback<string> OnViewSubscriptions { get; set; }

    private string searchTerm = string.Empty;
    private bool sortAscending = true;

    private IEnumerable<EntityInfo> FilteredTopics
    {
        get
        {
            var filtered = Topics.AsEnumerable();
            
            if (!string.IsNullOrWhiteSpace(searchTerm))
            {
                filtered = filtered.Where(t => t.Name.Contains(searchTerm, StringComparison.OrdinalIgnoreCase));
            }
            
            filtered = sortAscending 
                ? filtered.OrderBy(t => t.Name) 
                : filtered.OrderByDescending(t => t.Name);
            
            return filtered;
        }
    }

    private string GetSortIcon()
    {
        return sortAscending ? "▲" : "▼";
    }

    private void HandleSortColumn(string columnName)
    {
        sortAscending = !sortAscending;
    }
}
