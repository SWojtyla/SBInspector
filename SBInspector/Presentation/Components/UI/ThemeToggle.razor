@rendermode InteractiveServer
@inject ThemeService ThemeService
@inject IJSRuntime JSRuntime

<button class="btn btn-outline-secondary btn-sm theme-toggle" @onclick="ToggleThemeAsync" title="@GetThemeTooltip()">
    @if (ThemeService.IsDarkMode)
    {
        <i class="bi bi-sun-fill"></i>
    }
    else
    {
        <i class="bi bi-moon-fill"></i>
    }
</button>

@code {
    private bool _isProcessing = false;

    private async Task ToggleThemeAsync()
    {
        // Prevent multiple simultaneous clicks
        if (_isProcessing)
            return;

        try
        {
            _isProcessing = true;
            ThemeService.ToggleTheme();
            var isDarkMode = ThemeService.IsDarkMode;
            
            var script = isDarkMode 
                ? "document.body.classList.remove('light-theme'); document.body.classList.add('dark-theme');"
                : "document.body.classList.remove('dark-theme'); document.body.classList.add('light-theme');";
            
            await JSRuntime.InvokeVoidAsync("eval", script);
            
            // Update the UI to reflect the new theme state
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error toggling theme: {ex.Message}");
            Console.WriteLine($"Stack trace: {ex.StackTrace}");
        }
        finally
        {
            _isProcessing = false;
        }
    }

    private string GetThemeTooltip()
    {
        return ThemeService.IsDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode";
    }
}

